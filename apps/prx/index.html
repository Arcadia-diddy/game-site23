<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>have fun</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background:#121212; color:#e0e0e0; line-height:1.6;}
        header{background:#1f1f1f; color:#00bfff; padding:1.2rem;
               text-align:center; box-shadow:0 2px 10px rgba(0,0,0,.3);
               position:relative;}
        header h1{margin:0; font-size:1.8rem; font-weight:600;}
        .home-link,.fs-btn{
            position:absolute; top:50%; transform:translateY(-50%);
            background:#333; color:#00bfff; border:1px solid #00bfff;
            padding:.5rem 1rem; border-radius:6px; font-size:.9rem;
            font-weight:600; cursor:pointer; transition:all .2s;
            text-decoration:none;
        }
        .home-link{left:1rem;}
        .fs-btn{right:1rem;}
        .home-link:hover,.fs-btn:hover{background:#00bfff;color:#121212;}
        .container{max-width:900px;margin:2rem auto;padding:0 1rem;}
        .search{display:flex; gap:.6rem; margin-bottom:1.2rem;
                background:#1e1e1e; padding:.8rem; border-radius:8px;
                box-shadow:0 4px 12px rgba(0,0,0,.2);}
        input[type=text]{
            flex:1; padding:.75rem 1rem; font-size:1rem;
            background:#2d2d2d; color:#fff; border:1px solid #444;
            border-radius:6px; outline:none;
        }
        input[type=text]:focus{
            border-color:#00bfff; box-shadow:0 0 0 2px rgba(0,191,255,.2);
        }
        button{
            padding:.75rem 1.5rem; font-size:1rem; font-weight:600;
            background:#00bfff; color:#121212; border:none;
            border-radius:6px; cursor:pointer;
        }
        button:hover{background:#009edc;}
        iframe{
            width:100%; height:calc(100vh - 200px);
            border:none; border-top:1px solid #333;
            background:#000; border-radius:0 0 8px 8px;
        }
        .note{font-size:.85rem;color:#888;margin-top:.8rem;text-align:center;}
        .note code{background:#2d2d2d;padding:2px 6px;border-radius:4px;
                   font-family:'Courier New',monospace;}
    </style>
</head>
<body>

<header>
    <a href="/" class="home-link">Home</a>
    <h1>browse</h1>
    <button class="fs-btn" id="fsBtn">Fullscreen</button>
</header>

<div class="container">
    <div class="search">
        <input type="text" id="urlInput"
               placeholder="enter site or search term" autocomplete="off">
        <button id="goBtn">Go</button>
    </div>

    <!-- YOUR ORIGINAL NOTE - NEVER CHANGED -->
    <p class="note">
        powered by allorigins - some sites may not work
    </p>

    <iframe id="proxyFrame"
            sandbox="allow-scripts allow-same-origin allow-forms allow-modals allow-popups">
    </iframe>
</div>

<script>
    const input   = document.getElementById('urlInput');
    const btn     = document.getElementById('goBtn');
    const frame   = document.getElementById('proxyFrame');
    const fsBtn   = document.getElementById('fsBtn');

    const PROXY_PAGE = location.href.split('?')[0];

    function isValidUrl(s){
        const t=s.trim();
        return t && (t.includes('.') && !t.includes(' ')) || /^https?:\/\//i.test(t);
    }
    function normalizeUrl(s){
        let u=s.trim();
        if(!/^https?:\/\//i.test(u)) u='https://'+u;
        return u;
    }

    // Read ?url= from current URL
    const urlParam = new URLSearchParams(location.search).get('url');
    if (urlParam) {
        input.value = decodeURIComponent(urlParam);
        setTimeout(loadSite, 100);
    }

    async function loadSite(){
        const raw = input.value.trim() || urlParam;
        if(!raw) return alert('Enter a site or search term');

        const target = isValidUrl(raw)
            ? normalizeUrl(raw)
            : 'https://html.duckduckgo.com/html/?q='+encodeURIComponent(raw);

        try{
            const r = await fetch('https://api.allorigins.win/raw?url='+encodeURIComponent(target));
            if(!r.ok) throw new Error('fetch failed');
            const html = await r.text();

            // INJECTED SCRIPT - SAFE, NO top, NO ERRORS
            const inj = `<script>
                const PROXY = "${PROXY_PAGE}";
                const BASE  = "${target.split('/').slice(0,3).join('/')}";

                // Helper: go through proxy
                function go(url) {
                    const abs = url.startsWith('http') ? url : new URL(url, location.href).href;
                    window.parent.location = PROXY + '?url=' + encodeURIComponent(abs);
                }

                // Links
                document.addEventListener('click', e => {
                    const a = e.target.closest('a');
                    if (!a || a.target === '_blank' || a.href.startsWith('javascript:')) return;
                    e.preventDefault();
                    go(a.href);
                }, true);

                // Forms
                document.addEventListener('submit', e => {
                    const f = e.target;
                    if (f.target === '_blank') return;
                    e.preventDefault();
                    const action = f.action || location.href;
                    const url = new URL(action, location.href);
                    if (f.method.toUpperCase() === 'GET') {
                        for (let [k,v] of new FormData(f)) url.searchParams.append(k,v);
                    }
                    go(url.href);
                });

                // location.href / assign / replace
                ['href','assign','replace'].forEach(m => {
                    const orig = location[m];
                    location[m] = function(u) {
                        const abs = u.startsWith('http') ? u : new URL(u, location.href).href;
                        if (abs.startsWith(BASE)) {
                            go(abs);
                        } else {
                            orig.call(this, u);
                        }
                    };
                });
            <\/script>`;

            const finalHtml = html.replace(/<\/head>/i, inj + '</head>');
            frame.srcdoc = finalHtml;

            fsBtn.style.display = 'block';

            // Update URL with ?url= but keep it clean in address bar
            history.replaceState(null, '', PROXY_PAGE + '?url=' + encodeURIComponent(target));

        }catch(e){
            frame.srcdoc = `<h1 style="color:red;text-align:center;margin-top:100px;">
                            Failed to load: ${e.message}</h1>`;
        }
    }

    btn.addEventListener('click', loadSite);
    input.addEventListener('keydown', e => { if(e.key==='Enter') loadSite(); });

    // Fullscreen
    fsBtn.addEventListener('click', () => {
        if (!document.fullscreenElement) {
            frame.requestFullscreen().catch(() => {});
            fsBtn.textContent = 'Exit';
        } else {
            document.exitFullscreen();
            fsBtn.textContent = 'Fullscreen';
        }
    });
    document.addEventListener('fullscreenchange', () => {
        fsBtn.textContent = document.fullscreenElement ? 'Exit' : 'Fullscreen';
    });
    fsBtn.style.display = 'none';
</script>

</body>
</html>